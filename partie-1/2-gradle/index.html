<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<title>Gradle</title>
<link rel="stylesheet" href="./../../style.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Gradle</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_installation">1. Installation</a></li>
<li><a href="#_gradle_init">2. gradle init</a></li>
<li><a href="#_gradle_build">3. gradle build</a></li>
<li><a href="#_tuning">4. Tuning</a>
<ul class="sectlevel2">
<li><a href="#_version">4.1. version</a></li>
<li><a href="#_version_de_java">4.2. version de java</a></li>
</ul>
</li>
<li><a href="#_tâches">5. tâches</a></li>
<li><a href="#_dépendances">6. dépendances</a></li>
<li><a href="#_les_repositories_distants">7. les repositories distants</a></li>
<li><a href="#_plugins">8. plugins</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><span class="image"><img src="gradle.jpg" alt="Gradle" width="40" height="40"></span> Gradle est un outils de build écrit en groovy.</p>
</div>
<div class="paragraph">
<p>Son rôle est de s&#8217;occuper de tout ce qui peut être automatisé lors de la construction du projet.</p>
</div>
<div class="paragraph">
<p>A la sortie, il produit un <strong>artéfact</strong> comme par exemple une librairie, une application web, de la documentation&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>En java, c&#8217;est souvent un <strong>jar</strong> (java archive) ou un <strong>war</strong> (web archive).</p>
</div>
<div class="paragraph">
<p>Le produit peut être numéroté (ex : mon-projet-1.1.3.zip en <a href="http://semver.org/">semver</a>) et archivé.</p>
</div>
<div class="paragraph">
<p>Idéalement, le build éxécute les tests et produit des rapports.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Les dépendances</div>
<div class="paragraph">
<p>Pour construire le produit, on a besoin de librairies : les dépendances (.jar en java).</p>
</div>
<div class="paragraph">
<p>Gradle va les chercher dans des repositories distants et compile notre code source avec.</p>
</div>
<div class="paragraph">
<p>La configuration du build est dans un fichier <strong>build.gradle</strong> à la racine du projet.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Alternatives</div><div class="content">
<div class="paragraph">
<p>Les principales alternatives dans le monde java sont</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ant</strong> : le premier outils de build en java configuré en xml.</p>
</li>
<li>
<p><strong>maven</strong> : aussi configuré en xml, mais apporte énormément de conventions.</p>
</li>
<li>
<p><strong>sbt</strong> : l&#8217;outils de build du monde scala.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation">1. Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sous mac, le plus simple est de passer par <a href="http://brew.sh/">homebrew</a>.</p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre class="CodeRay highlight"><code>test-project$ brew install gradle</code></pre>
</div>
</div>
<div class="paragraph">
<p>Pour les autres, voici la <a href="https://docs.gradle.org/current/userguide/installation.html">documentation</a></p>
</div>
<div class="paragraph">
<p>On peut vérifier que l&#8217;installation a réussie</p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre class="CodeRay highlight"><code>test-project$ gradle -v

------------------------------------------------------------
Gradle 2.4
------------------------------------------------------------

Build time:   2015-05-05 08:09:24 UTC
Build number: none
Revision:     5c9c3bc20ca1c281ac7972643f1e2d190f2c943c

Groovy:       2.3.10
Ant:          Apache Ant(TM) version 1.9.4 compiled on April 29 2014
JVM:          1.8.0_20 (Oracle Corporation 25.20-b23)
OS:           Mac OS X 10.10.3 x86_64</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gradle_init">2. gradle init</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nous allons rajouter les fichiers lié à la définition du build gradle</p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre class="CodeRay highlight"><code>test-project$ gradle init
:wrapper
:init

BUILD SUCCESSFUL

Total time: 3.248 secs

This build could be faster, please consider using the Gradle Daemon: http://gradle.org/docs/2.4/userguide/gradle_daemon.html</code></pre>
</div>
</div>
<div class="paragraph">
<p>La commande a effectuée 2 tâches : wrapper et init.</p>
</div>
<div class="paragraph">
<p>On peut voir les fichiers générés.</p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre class="CodeRay highlight"><code>test-project$ ls -la

drwxr-xr-x   9 user  staff   306 22 jui 13:45 .
drwxr-xr-x  59 user  staff  2006 22 jui 13:45 ..
-rw-r--r--   1 user  staff    46 22 jui 13:44 .gitignore
drwxr-xr-x   3 user  staff   102 22 jui 13:45 .gradle         # rép. de cache
-rw-r--r--   1 user  staff  1236 22 jui 13:45 build.gradle    # fichier de build
drwxr-xr-x   3 user  staff   102 22 jui 13:45 gradle          # rép. qui contient le wrapper
-rwxr-xr-x   1 user  staff  5080 22 jui 13:45 gradlew         # script wrapper pour linux
-rw-r--r--   1 user  staff  2404 22 jui 13:45 gradlew.bat     # script wrapper pour windows
-rw-r--r--   1 user  staff   646 22 jui 13:45 settings.gradle # config multi projet</code></pre>
</div>
</div>
<div class="paragraph">
<p>Les fichiers <strong>gradlew</strong>, <strong>gradlew.bat</strong> et le répertoire <strong>gradle</strong> constitue le <strong>wrapper</strong>.
Il permettent de lancer le build sans avoir à installer préalablement gradle.
C&#8217;est pratique pour de l&#8217;intégration continue ou bien pour tester rapidement sur une machine qui n&#8217;a pas gradle.</p>
</div>
<div class="paragraph">
<p>Le fichier <strong><a href="https://docs.gradle.org/current/dsl/org.gradle.api.initialization.Settings.html">settings.gradle</a></strong> est utile dans le cas d&#8217;un projet qui a des sous modules.</p>
</div>
<div class="paragraph">
<p>Le fichier <strong><a href="https://docs.gradle.org/current/userguide/tutorial_using_tasks.html">build.gradle</a></strong> est celui qui contient la logique du build.</p>
</div>
<div class="paragraph">
<p>On peut ajouter un <strong>gradle.properties</strong> qui permet de <a href="https://docs.gradle.org/current/userguide/build_environment.html">configurer l&#8217;environnement de build</a></p>
</div>
<div class="paragraph">
<p>En l&#8217;état, le build.gradle contient</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">/*
 * This build file was auto generated by running the Gradle 'init' task
 * by 'dbourdette' at '22/06/15 13:45' with Gradle 2.4
 *
 * This generated file contains a commented-out sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * user guide available at http://gradle.org/docs/2.4/userguide/tutorial_java_projects.html
 */</span>

<span class="comment">/*
// Apply the java plugin to add support for Java
apply plugin: 'java'

// In this section you declare where to find the dependencies of your project
repositories {
    // Use 'jcenter' for resolving your dependencies.
    // You can declare any Maven/Ivy/file repository here.
    jcenter()
}

// In this section you declare the dependencies for your production and test code
dependencies {
    // The production code uses the SLF4J logging API at compile time
    compile 'org.slf4j:slf4j-api:1.7.12'

    // Declare the dependency for your favourite test framework you want to use in your tests.
    // TestNG is also supported by the Gradle Test task. Just change the
    // testCompile dependency to testCompile 'org.testng:testng:6.8.1' and add
    // 'test.useTestNG()' to your build script.
    testCompile 'junit:junit:4.12'
}
*/</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gradle_build">3. gradle build</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Pour que le build génère quelque chose, on change notre build.gradle</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>

repositories {
    jcenter()
}

dependencies {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Avec <code>gradle build</code></p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre class="CodeRay highlight"><code>test-project$ gradle build
:compileJava UP-TO-DATE
:processResources UP-TO-DATE
:classes UP-TO-DATE
:jar
:assemble
:compileTestJava UP-TO-DATE
:processTestResources UP-TO-DATE
:testClasses UP-TO-DATE
:test UP-TO-DATE
:check UP-TO-DATE
:build

BUILD SUCCESSFUL

Total time: 2.518 secs</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cela génère le jar dans build/libs</p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre class="CodeRay highlight"><code>test-project$ ls build/libs/
test-project.jar</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tuning">4. Tuning</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_version">4.1. version</h3>
<div class="paragraph">
<p>Si on souhaite que notre jar soit versionné, on peut rajouter le gradle.properties.</p>
</div>
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">version=1.0.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Un <code>gradle clean build</code> donne alors</p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre class="CodeRay highlight"><code>test-project$ ls build/libs/
test-project-1.0.0.jar</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_version_de_java">4.2. version de java</h3>
<div class="paragraph">
<p>Il est aussi important d&#8217;indiquer quel est la version cible de java dans le build.gradle</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>

repositories {
    jcenter()
}

sourceCompatibility=<span class="float">1.8</span>

dependencies {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Pour faire le build, il faut maintenant un jdk 8 par défaut sur sa machine.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tâches">5. tâches</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>build</code> n&#8217;est qu&#8217;une tâche disponible parmis d&#8217;autres.</p>
</div>
<div class="paragraph">
<p>Il est possible de définir simplement ses propres tâches</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task hello &lt;&lt; {
    println <span class="string"><span class="delimiter">'</span><span class="content">Hello world!</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Chaque plugin, comme le <a href="https://docs.gradle.org/current/userguide/java_plugin.html">plugin java</a> vient avec son lot de tâches.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dépendances">6. dépendances</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Une dépendance est du code que l&#8217;on récupère et utilise depuis son projet.</p>
</div>
<div class="paragraph">
<p>Par exemple, afin d&#8217;utiliser junit pour les tests :</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>

repositories {
    jcenter()
}

sourceCompatibility=<span class="float">1.8</span>

dependencies {
    testCompile <span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.12</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>junit sera donc disponible pour les tests.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_les_repositories_distants">7. les repositories distants</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Gradle va chercher les dépendances dans des <a href="https://docs.gradle.org/current/userguide/artifact_dependencies_tutorial.html">repositories</a>.</p>
</div>
<div class="paragraph">
<p>Ici, nous avons utilisé <a href="https://bintray.com/bintray/jcenter">jcenter</a>. Il existe aussi <a href="http://search.maven.org/">mavenCentral</a></p>
</div>
<div class="paragraph">
<p>Il est possible de définir son propre repository local à son entreprise par exemple :</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/maven2</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_plugins">8. plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Voici quelques <a href="https://docs.gradle.org/current/userguide/standard_plugins.html">plugins standards</a> :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>les languages : java, groovy, scala, c et cpp</p>
</li>
<li>
<p>applications : application, ear, war et maven</p>
</li>
<li>
<p>qualité : checkstyle, codenarc, findbugs, jdepend, pmd et sonar</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Et bien sûr <a href="https://plugins.gradle.org/">tous les plugins</a></p>
</div>
</div>
</div>
</div>
</body>
</html>